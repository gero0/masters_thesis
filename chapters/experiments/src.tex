\chapter{Badania eksperymentalne}

Rozdział opisuje przeprowadzone w pracy badania. Sekcja \ref{section:algorithms} przedstawia wykorzystane algorytmy próbkowania,
a sekcja \ref{section:instances} zawiera opis analizowanych instancji problemu komiwojażera.
W kolejnych sekcjach opisane są przeprowadzone eksperymenty, oraz uzyskane z nich wyniki.

\section{Zaimplementowane algorytmy} \label{section:algorithms}

Na potrzeby badania wykonano implementacje dwóch algorytmów próbkowania - próbkowania dwufazowego oraz próbkowania \textit{snowball}.
Dodatkowo, aby możliwe było porównanie wyników próbkowania z rzeczywistą przestrzenią rozwiązań, zaimplementowano algorytm
przeglądu zupełnego.

\subsection{Próbkowanie dwufazowe} \label{section:tp}
Próbkowanie dwufazowe swoją nazwę zawdzięcza procesowi próbkowania składającemu się z dwóch oddzielnych faz
- próbkowania wierzchołków oraz próbkowania krawędzi --- wykonywanych jedna po drugiej.
Istotną zaletą tego podejścia jest jego stosunkowo prosta implementacja oraz możliwość łatwego zrównoleglenia.

Zaimplementowany algorytm pochodzi z pracy \cite{DBLP:conf/depcos/BozejkoGNAB18}.
Został on przygotowany specjalnie do próbkowania przestrzeni rozwiązań problemu komiwojażera.
Próbkowanie wierzchołków odbywa się poprzez generowanie losowych rozwiązań, a następnie ich optymalizacji algorytmem 2-opt.
Próbkowanie krawędzi polega na wielokrotnym poddaniu każdego ze znalezionych wcześniej lokalnych optimów $n_i$ operacji perturbacji typu 2-exchange,
a następnie poddaniu powstałego rozwiązania optymalizacji algorytmem 2-opt typu \textit{first-improvement} uzyskując w ten sposób lokalne optimum $n_j$.
Następnie dodawana jest krawędź między $n_i$ a $n_j$, lub --- jeśli już taka istnieje --- jej waga jest zwiększana o 1.

Algorytm przyjmuje trzy parametry: pożądaną liczbę wierzchołków do wygenerowania ($n_{max}$), maksymalną liczbę prób generowania wierzchołka ($n_{att}$)
oraz maksymalną liczbę prób generowania krawędzi($e_{att}$).
Implementacja zastosowana w tej pracy dodatkowo powtarza cały proces kilkukrotnie, za każdym razem zapisując zebrane próbki do pliku.

Algorytm w postaci pseudokodu został przedstawiony na listingu \ref{alg:tp}.

\subsection{Snowball} \label{section:snowball}
Próbkowanie typu Snowball wywodzi się z techniki używanej w badaniach z dziedziny socjologii, w której ludzie należący do próby z populacji
rekrutują kolejnych uczestników badania spośród swoich znajomych.
W kontekście badania przestrzeni rozwiązań technika ta została zaprezentowana w pracy \cite{DBLP:conf/ppsn/VerelDOT18}, gdzie została wykorzystana
do próbkowanie przestrzeni problemu kwadratowego przypisania (QAP).

Próbkowanie składa się z etapów procedury \textit{snowball} próbkującej ,,wgłąb'' i losowego spaceru(ang. \textit{random walk}).
Próbkowanie \textit{snowball} polega na wybraniu rozwiązania startowego i przeszukaniu jego najbliższego sąsiedztwa.
Następnie operacja ta jest powtarzana dla każdego rozwiązania w tym sąsiedztwie. Proces powtarza się aż do osiągnięcia z góry ustalonej głębokości
przeszukiwania. Następnie rozpoczyna się procedura losowego spaceru --- wybierane jest kolejne rozwiązanie startowe
ze zbioru sąsiadów poprzedniego rozwiązywania startowego (lub rozwiązanie losowe, jeśli to sąsiedztwo jest puste) i proces \textit{snowball}
rozpoczyna się od nowa. Procedura jest powtarzana aż osiągnięty zostanie z góry ustalony limit długości spaceru.

Zaimplementowany algorytm jest próbą adaptacji tej techniki do zadania przeszukiwania przestrzeni
problemu komiwojażera. Do najważniejszych modyfikacji należy zastąpienie funkcji optymalizacji lokalnej typu \textit{hillclimb}
optymalizacją 2opt, implementacja odpowiedniej funkcji celu oraz operacji mutacji typu 2-exchange.

Algorytm w postaci pseudokodu został przedstawiony na listingu \ref{alg:snowball}.

\newpage

\begin{algorithm}[H]
    \caption{Próbkowanie dwufazowe --- pseudokod}\label{alg:tp}

    \KwData{\\
        \Indp \Indp
        $n_{max}$ --- żądana liczba wierzchołków\\
        $n_{att}$ --- liczba prób generowania wierzchołków\\
        $e_{att}$ --- liczba prób generowania krawędzi\\
        $n_{runs}$ --- liczba powtórzeń\\
        $D$ --- stała D krawędzi
    }

    \vspace{1em}

    $N \gets \{\}$\;
    $E \gets \{\}$\;
    \For{$i\gets1$ \KwTo $n_{runs}$}{
        $probkujWierzcholki(N, n_{max}, n_{att})$\;
        $probkujKrawedzie(N, E, e_{att})$\;
        $zapiszDoPliku(N, E)$\;
    }
    \vspace{1em}

    \SetKwFunction{FV}{probkujWierzcholki}
    \SetKwProg{Fn}{function}{:}{}

    \Fn{\FV{$N, n_{max}, n_{att}$}}{
        \For{$i\gets1$ \KwTo $n_{max}$}{
            \For{$i\gets1$ \KwTo $n_{att}$}{
                $s \gets losoweRozwiazanie()$\;
                $s \gets 2opt(s)$\;
                $N \gets N \cup \{s\}$\;
            }
        }
    }
    \textbf{end}

    \vspace{1em}

    \SetKwFunction{FE}{probkujKrawedzie}

    \Fn{\FE{$N, E, e_{att}$}}{
        \ForEach{$n \in{N}$}{
            \For{$i\gets1$ \KwTo $e_{att}$}{
                $s \gets 2exchangeMutacja(n, D)$\;
                $s \gets 2optFirstImprovement(s)$\;
                \If{$s \in{N}$}{
                    $E \gets E \cup \{(n, s)\}$\;
                    $w_{ns} \gets w_{ns} + 1$\;
                }
            }
        }
    }
    \textbf{end}

    \vspace{1em}

\end{algorithm}

\begin{algorithm}[p]
    \caption{Próbkowanie snowball --- pseudokod}\label{alg:snowball}

    \KwData{\\
        \Indp \Indp
        $w_{len}$ --- długość losowego spaceru\\
        $m$ --- liczba prób przeszukania sąsiedztwa\\
        $depth$ --- głębokość przeszukiwania\\
        $D$ --- stała D krawędzi\\
        $s_{tresh}$ --- interwał zapisu
    }

    \vspace{1em}
    $s_1 \gets losoweRozwiazanie()$\;
    $n_1 \gets 2opt(s_1)$\;

    $N \gets \{ n_1 \}$\;
    $E \gets \{\}$\;
    \For{$j\gets1$ \KwTo $n_{runs}$}{
        \For{$i\gets1$ \KwTo $w_{len}$}{
            $snowball(n_i, m, depth)$\;
            $n_{i+1} \gets losowySpacer(n_i)$\;
        }
    }
    $zapiszDoPliku(N, E)$\;
    \vspace{1em}

    \SetKwFunction{FS}{snowball}
    \SetKwProg{Fn}{function}{:}{}

    \Fn{\FS{$n, m, depth$}}{
        \If{$d > 0$}{
            \For{$i\gets1$ \KwTo $m$}{
                $s \gets 2opt(2exchangeMutacja(n, D))$\;
                $N \gets N \cup \{ s \}$\;
                \If{$|N| \hspace{0.5em} mod \hspace{0.5em} s_{tresh} = 0$}{
                    $zapiszDoPliku(N, E)$\;
                }
                \uIf{$(n, s) \in{E}$}{
                    $w_{ns} \gets w_{ns} + 1$\;
                }
                \Else{
                    $E \gets E \cup \{ (n, s) \}$\;
                    $w_{ns} \gets 1$\;
                    $snowball(s, m, d-1)$\;
                }
            }
        }
    }
    \textbf{end}

    \vspace{1em}

    \SetKwFunction{FW}{losowySpacer}

    \Fn{\FW{$n_i$}}{
        $neighbours \gets \{ s: (n_i, s) \in E \land s \notin \{ n_0...n_i \} \}$\;
        \uIf{$neighbours \neq \emptyset $}{
            $n_{i+1} \gets losowyElementZeZbioru(neighbours)$\;
        }
        \Else{
            $s \gets losoweRozwiazanie()$\;
            $n_{i+1} \gets 2opt(s)$\;
            $N \gets N \cup \{ n_{i+1} \}$\;
            \If{$|N| \hspace{0.5em} mod \hspace{0.5em} s_{tresh} = 0$}{
                $zapiszDoPliku(N, E)$\;
            }
        }
        \Return $n_{i+1}$
    }
    \textbf{end}

    \vspace{1em}

\end{algorithm}

\newpage

\subsection{Przegląd zupełny}
Ze względu na złożoność problemu komiwojażera oraz rozmiar przestrzeni rozwiązań, przegląd zupełny można zastosować tylko do bardzo małych instancji problemu.
Przegląd polega na wygenerowaniu wszystkich możliwych rozwiązań danej instancji, wykonaniu na nich optymalizacji 2-opt w celu znalezienia
optimów lokalnych a następnie znalezieniu krawędzi oraz obliczeniu ich wag. Dla każdego z rozwiązań generowane są wszystkie
permutacje, które mogą powstać poprzez D-krotne wykonanie na rozwiązaniu operacji 2-exchange. Jeśli wśród tych permutacji znajduje się jedno ze znalezionych wcześniej
lokalnych optimów, oznacza to, że spełniony jest warunek \ref{eq:escape_edge_cond} i dodawana jest nowa krawędź lub zwiększona zostaje waga istniejącej.
Algorytm został przedstawiony na listingu \ref{alg:exhaustive}.

\begin{algorithm}[]
    \caption{Przegląd zupełny}\label{alg:exhaustive}
    $S \gets \{\}$\;
    $P \gets wygenerujWszystkiePermutacje()$\;
    \ForEach{$p \in P$}{
        $lo \gets 2optFirstImprovement(p)$\;
        $S \gets S \cup \{(p, lo)\}$\;
    }

    \SetKwProg{Fn}{function}{:}{}

    \ForEach{$(p, lo) \in S$}{
        \ForEach{$n \in N$}{
            \If{$wZasiegu2Exchange(p, n, D)$}{
                \uIf{$(n, lo) \in E$}{
                    $w_{n, lo} \gets w_{n, lo} + 1$\;
                }\Else{
                    $E \gets E \cup \{(n, lo)\}$\;
                    $w_{n, lo} = 1$\;
                }
            }
        }
    }

    \SetKwFunction{FI}{wZasiegu2Exchange}

    \vspace{1em}

    \Fn{\FI{$p, n, D$}}{
        $permutacje \gets \{p\}$\;
        \For{$i \in 1..D$}{
            $nowe\_perm \gets \{\}$\;
            \ForEach{$perm \in permutacje$}{
                $pochodne\_perm \gets 2exchangeWszystkiePermutacje(permutacje)$\;
                \ForEach{$poch\in pochodne\_perm$}{
                    \If{poch = n}{
                        \Return{true}\;
                    }
                    $nowe\_perm \gets nowe\_perm \cup \{poch\}$\;
                }
            }
            $permutacje \gets nowe\_perm$\;
        }
        \Return{false}\;
    }
    \textbf{end}

\end{algorithm}

\section{Instancje testowe} \label{section:instances}
Do badań wykorzystano instancje testowe wygenerowane losowo oraz wybrane instancje ze zbioru TSPLIB.
Zaimplementowano trzy generatory tworzące różne typy instancji testowych: z miastami rozłożonymi równomiernie,
z miastami rozłożonymi w klikach oraz z miastami ułożonymi na siatce.
Wygenerowano instancje testowe każdego z trzech typów instancji losowych o rozmiarach 7, 8, 9, 10, 11 oraz 20, 50, 80 i 100.
Uzyskano w ten sposób 27 instancji problemu.
Ze zbioru TSPLIB wybrano instancje o podobnych rozmiarach: \textbf{burma14}, \textbf{ulysses22}, \textbf{att48}, \textbf{berlin52}, \textbf{pr76}, \textbf{eil76}, \textbf{rat99},
\textbf{bier127}.
W sumie badanie przeprowadzono na 35 instancjach problemu.

\subsection*{Miasta rozmieszczone równomiernie}
Generator losowo rozmieszcza miasta na wirtualnej planszy o ustalonym rozmiarze.\\
Współrzędne miast generowane są losowo z rozkładu równomiernego.
W dalszej części dokumentu instancje wygenerowane tym generatorem będą nazywane \textbf{uniform\_<liczba miast>}.

Przykład wygenerowanej instancji został przedstawiony na rysunku \ref{fig:uniform_example}.

\subsection*{Miasta rozmieszczone w klikach}
Miasta umieszczane są blisko siebie w kilku grupach oddzielonych większymi odległościami.
W dalszej części dokumentu instancje wygenerowane tym generatorem będą nazywane \textbf{cliques\_<liczba miast>}.
Przykład wygenerowanej instancji został przedstawiony na rysunku \ref{fig:clique_example}.


\subsection*{Miasta rozmieszczone na siatce}
Miasta umieszczane są na siatce, w stałej odległości od swoich sąsiadów.
W dalszej części dokumentu instancje wygenerowane tym generatorem będą nazywane \textbf{grid\_<liczba miast>}.
Przykład wygenerowanej instancji został przedstawiony na rysunku \ref{fig:grid_example}.

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.46\textwidth]{chapters/experiments/img/uniform_example.png}
    \caption{Wizualizacja przykładowej wygenerowanej instancji z miastami rozmieszczonymi równomiernie dla 100 miast}
    \label{fig:uniform_example}
\end{figure}

\newpage

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.60\textwidth]{chapters/experiments/img/clique_example.png}
    \caption{Wizualizacja przykładowej wygenerowanej instancji z miastami rozmieszczonymi w klikach dla 100 miast}
    \label{fig:clique_example}
\end{figure}

\begin{figure}[h!]
    \centering
    \includegraphics[width=0.60\textwidth]{chapters/experiments/img/grid_example.png}
    \caption{Wizualizacja przykładowej wygenerowanej instancji z miastami rozmieszczonymi na siatce dla 100 miast}
    \label{fig:grid_example}
\end{figure}

\section{Opis badań}

Badania podzielono na trzy etapy, odpowiadające poszczególnym celom pracy:

\begin{enumerate}
    \item Porównanie wartości metryk z przeglądem zupełnym dla małych instancji, celem sprawdzenia dokładności odwzorowania przestrzeni rozwiązań przez algorytmy próbkowania (sekcja \ref{section:experimentcomp}),
    \item Badanie stabilności średnich i dużych instancji - długotrwałe próbkowanie przeprowadzone w celu zbadania wpływu metody i długości próbkowania na wartości miar (sekcje \ref{section:experimentsmall} i \ref{section:experimentmain}),
    \item Badanie korelacji wzajemnej poszczególnych miar, oraz wpływu metody próbkowania na ich wartości (sekcja \ref{section:experimentcorr}).
\end{enumerate}

W tym rozdziale przedstawione zostaną tabele i wykresy wygenerowane z wyników próbkowania.
Nazwy metryk są identyczne z nazwami objaśnionymi w rozdziale \ref{sec:metrics}.
Ponadto występują pojęcia:

\begin{itemize}
    \item node\_count --- liczba wierzchołków,
    \item edge\_count --- liczba krawędzi,
    \item opt\_count --- liczba wywołań funkcji 2opt,
    \item oracle\_count --- liczba wykonanych obliczeń długości ścieżki (metodą obliczenia przyrostu długości stosowanej w 2opt).
    \item twophase --- algorytm dwufazowy
\end{itemize}

Wszystkie badania wykonano wykorzystując model krawędzi typu \textit{Escape Edges} z parametrem $D$ o wartości 2.

\subsection{Porównanie wartości metryk dla małych instancji} \label{section:experimentcomp}
Aby sprawdzić, z jaką dokładnością algorytmy próbkowania odwzorowują rzeczywistą przestrzeń rozwiązań,
porównano wartości miar uzyskane z próbkowania z rzeczywistymi wartościami uzyskanymi z przeglądu zupełnego.
Wykorzystano w tym celu instancje wygenerowane losowo (uniform, grid, cliques) o rozmiarach 7 do 11, dla których wykonanie takiego przeglądu jest możliwe.
Aby ocenić, ile czasu jest potrzebne na wykonanie próbkowania z zadowalającą dokładnością wyników, uruchomiono algorytmy kilkukrotnie,
za każdym razem zwiększając czas ich działania.

Dla algorytmu dwufazowego wykonano próbkowanie dla różnych wartości parametru $n_{max}$ (liczby żądanych wierzchołków): 10, 40, 100 oraz 1000.
Parametry $n_{att}$, $e_{att}$ ustawiono na równe $n_{max}$, a parametr $n_{runs}$ na 1.
Dla algorytmu \textit{snowball} wykonano próbkowanie dla różnych wartości parametru $w_{len}$ (długości losowego spaceru): 1, 10, 100 oraz 1000.
Pozostałe parametry ustawiono następująco: $m$ = 100, $depth$ = 3.

Uzyskane wartości porównano z wartościami uzyskanymi z przeglądu zupełnego.
Wyniki przedstawiono w tabelach od \ref{tab:comp_uniform_7_snowball} do \ref{tab:comp_grid_11_twophase}.
W tabeli przedstawiono wartości metryk uzyskane w przeglądzie zupełnym oraz wartości uzyskane z próbkowania.
Dodatkowo w nawiasie podana została wartość błędu obliczona z wzoru \ref{eq:relError}.
\begin{equation}
    \label{eq:relError}
    E = \frac{|R - S|}{R} \cdot 100\%
\end{equation}
Gdzie:
\begin{itemize}
    \item E --- wartość błędu
    \item R --- wartość rzeczywista (z przegl. zupełnego)
    \item S --- wartość otrzymana z próbkowania.
\end{itemize}

Wartości, dla których błąd nie wyniósł 0 zostały dodatkowo oznaczone w tabeli grubą czcionką.
Przebadano wszystkie miary opisane w sekcji \ref{sec:metrics} za wyjątkiem assortativity\_deg --- wartość ta dla małych instancji zwykle przyjmowała
nieprawidłową wartość (NaN), więc zdecydowano o jej wykluczeniu.

\subsubsection{Wyniki}

\include{tables.tex}

Najbardziej rzucającymi się w oczy metrykami są avg\_loop\_weight i distLO.
We wszystkich przypadkach występuje duża rozbieżność między wartościami tych miar uzyskanymi z próbkowania, a tymi z przeglądu zupełnego.
Nie jest to zaskakujące. Algorytm przeglądu zupełnego jednokrotnie sprawdza każde rozwiązanie w przestrzeni przeszukiwania pod kątem
możliwości utworzenia krawędzi między optimami lokalnymi, lub zwiększenia wagi istniejącej.
Po sprawdzeniu wszystkich rozwiązań algorytm kończy pracę.
Algorytmy próbkowania nie kończą pracy aż do momentu osiągnięcia warunku zatrzymania.
Ze względu na swój losowy charakter, po operacji perturbacji często trafiają na te same rozwiązania
(szczególnie w przypadku małych instancji) i powodują zwiększanie wagi krawędzi, w tym pętli, do wartości znacznie większych od rzeczywistych.
Dlatego metryki, których wartość zależy od bezwzględnych wartości wag, a nie od stosunku wag różnych krawędzi nie dają użytecznej informacji na temat małych instancji.
Z tego też powodu ich wartość nie będzie brana pod uwagę w ocenie działania algorytmu.

W przypadku najmniejszych instancji o rozmiarze 7, błąd uzyskany po porównaniu wartości metryk
wynosił 0 lub był bliski 0 dla wszystkich metryk oprócz avg\_loop\_weight i distLO.
Wyjątkiem była instancja uniform\_7, gdzie wartości błędów były wyższe dla obu algorytmów.
W tej instancji algorytm snowball poradził sobie znacznie lepiej --- brak błędu dla większości
metryk wystąpił już dla parametru $w_{len}$ równego 10, natomiast algorytm dwufazowy
podobny wynik uzyskał dopiero dla parametru $n_{max}$ równego 1000 --- wymagało to ponad 600 razy więcej wywołań funkcji optymalizującej.
Dla instancji tej wielkości przegląd zupełny jest szybki, dlatego nie ma sensu stosować dla nich próbkowania.

Obu algorytmom udało się dobrze odwzorować cechy przestrzeni rozwiązań instancji uniform\_8 i grid\_8 (z wyjątkiem distLO i avg\_loop\_weight),
w czasie próbkowania kilkukrotnie krótszym od czasu trwania przeglądu zupełnego. Wyjątkiem okazała się instancja cliques\_8, której dokładne spróbkowanie
udało się dopiero dla $n_{max}$ równego 100 --- próbkowanie trwało prawie dwa razy tyle czasu, co przegląd zupełny.
Algorytm snowball poradził sobie znakomicie już dla wartości $w_{len}$ równej 10 --- próbkowanie było ponad dwukrotnie krótsze od przeglądu zupełnego.

Dla instancji uniform\_9 i cliques\_9 oba algorytmy dobrze odwzorowały przestrzeń w czasie znacznie krótszym od czasu przeglądu zupełnego.
Jednak w przypadku instancji grid\_9 nawet najdłuższe przebiegi testowanych algorytmów nie pozwoliły na uzyskanie zerowego błędu dla wszystkich
miar z wyłączeniem distLO i avg\_loop\_weight.
Algorytm snowball ujawnia tu swoją wadę --- mimo znalezienia wszystkich krawędzi i wierzchołków wartości miar largest\_clique\_size i reciprocity
nie zą zgodne z wartościami uzyskanymi z przeglądu zupełnego. Jest to spowodowane tym, że zarówno przegląd zupełny jak i algorytm dwufazowy używają
algorytmu 2opt typu fist-improvement w procedurze perturbacji. Algorytm snowball używa zaś optymalizacji typu best-improvement, co powoduje nieznaczne,
ale widoczne różnice topologii zbudowanej sieci LON.
Pomimo korzystania z 2opt typu fist-improvement, algorytm dwufazowy nie poradził sobie z dokładnym odwzorowaniem przestrzeni instancji grid\_9 i ostatecznie
lepszy w tym przypadku okazał się algorytm snowball.

W przypadku instancji o rozmiarze 10 coraz bardziej widoczna staje się różnica między poszczególnymi typami instancji --- instancje z miastami
ułożonymi w klikach nie sprawiają problemów --- oba algorytmy dla większości miar otrzymują wartość prawdziwą w czasie krótszym od przeglądu zupełnego.
Instancja uniform\_10 nie jest już idealnie odwzorowywana --- algorytmy nie docierają do niektórych krawędzi i pojawiają się niewielkie błędy.
Instancja grid\_10 sprawia problemy obu algorytmom. Warto jednak zauważyć, że wartości błędów dla przebiegu snowball\_1000 są mniejsze od błędów
z przebiegu dwufazowy\_1000 pomimo tego, że ten drugi trwa 10 razy dłużej.

Instancja uniform\_11 okazała się rzadkim przypadkiem, w którym algorytm dwufazowy poradził sobie lepiej od algorytmu snowball w podobnym czasie.
Snowball okazuje się lepszy dla instancji cliques\_11 --- oba algorytmy w najdłuższym przebiegu znajdują prawdziwą wartość większości miar, ale snowball robi to szybciej.
Instancja grid\_11 zawiera dużą ilość wierzchołków i krawędzi --- nawet najdłuższe przebiegi obu algorytmów nie były w stanie znaleźć wszystkich,
co poskutkowało znacznymi błędami.

\subsection{Badanie stabilności dla średnich instancji} \label{section:experimentsmall}
Aby zbadać wpływ długości i metody próbkowania na wartości miar przestrzeni rozwiązań,
wykonano długotrwałe próbkowanie przestrzeni, podczas którego zapisywano jej stan w postaci sieci LON w określonych interwałach.
Na podstawie zebranych danych obliczono wartości miar w poszczególnych etapach i przedstawiono je w relacji do wielkości spróbkowanej przestrzeni,
wyrażonej jako liczba obecnych w niej wierzchołków. Pozwoliło to na zidentyfikowanie miar stabilnych i niestabilnych oraz na obserwację różnic w działaniu poszczególnych
algorytmów próbkowania.

Instancje \textbf{burma14}, \textbf{ulysses22} ze zbioru tsplib oraz wygenerowane instancje
\textbf{cliques\_20}, \textbf{uniform\_20} oraz \textbf{grid\_20}
są zbyt małe, żeby próbkować je z takimi samymi parametrami, jak większe instancje.
Z tego powodu badania na nich przeprowadzone umieszczono w osobnej sekcji.
Dla instancji tego typu wykonano bardziej szczegółowe próbkowanie z mniejszymi interwałami zapisu.
Badania większych instancji przedstawiono w sekcji \ref{section:experimentmain}.

Próbkowanie algorytmem snowball wykonano z następującymi parametrami:
\begin{itemize}
    \item $w_{len}$ --- długość losowego spaceru --- 10000
    \item $m$ --- liczba prób przeszukania sąsiedztwa --- 100
    \item $depth$ --- głębokość przeszukiwania --- 3
\end{itemize}
Zapis wyników wykonywano przy każdym znalezionym wierzchołku.
Wyjątkiem była instancja grid\_20 --- tu zapis wykonywano co 100 wierzchołków z powodu dużej liczby optimów lokalnych.

Próbkowanie algorytmem dwufazowym przeprowadzono z następującymi parametrami:
\begin{itemize}
    \item $n_{max}$ --- żądana liczba wierzchołków --- 1
    \item $n_{att}$ --- liczba prób generowania wierzchołków --- 1000
    \item $e_{att}$ --- liczba prób generowania krawędzi --- 10
    \item $n_{runs}$ --- liczba powtórzeń --- 1000
\end{itemize}
Zapis wyników wykonywano po zakończeniu każdego powtórzenia.

Utworzono wykresy przedstawiające zależność wartości miar od liczby spróbkowanych wierzchołków.
Przedstawiono je na rysunkach od \ref{fig:small_edge_count} do \ref{fig:small_missed}.

\subsubsection{Wyniki}
Obrazy zawierające wykresy nie są wymagane do zrozumienia wyników.
Zostały one zawarte w załączniku. Dla wygody czytelnika w opisie wyników umieszczono odnośniki do poszczególnych wykresów.

Zależność liczby krawędzi od liczby wierzchołków jest nieliniowa dla wszystkich zbadanych instancji i obu algorytmów (rys. \ref{fig:small_edge_count}, rys. \ref{fig:small_edge_to_node}).
W przypadku metryki assortativity\_deg można zaobserwować pewną właściwość.
Na początku próbkowania wartość metryki zmienia się gwałtownie, zwiększając i zmniejszając się naprzemiennie (rys. \ref{fig:small_assortativity_deg}).
Po pewnym czasie jednak się stabilizuje, widoczne jest to zwłaszcza dla instancji z większą ilością optimów lokalnych.
Nadal obecne są wahania wartości, ale są one znacznie mniejsze.
Wyjątkiem jest instancja grid\_20 próbkowana algorytmem snowball.
W tym przypadku wartość zmienia się znacznie przez cały okres próbkowania.
W wielu przypadkach ostatnia uzyskana wartość różni się znacznie pomiędzy algorytmami.

W większości przypadków średnia wartość funkcji celu przestrzeni zwiększa się wraz z ilością wierzchołków (rys. \ref{fig:small_avg_fitness}).
W niektórych przypadkach występuje początkowo duża wartość i gwałtowny spadek, zwykle w przypadku próbkowania dwufazowego.
W innych przypadkach wartość wzrasta przez cały czas.
Wykresy wartości uzyskane z obu algorytmów różnią się, ale wartości uzyskane na końcu próbkowania są do siebie podobne.
Niska wartość funkcji celu na początku i powolny wzrost oznacza, że w badanych instancjach szybko znajdowane były
najlepsze rozwiązania w przestrzeni.

Wartość współczynnika conrel jest nieprzewidywalna (rys. \ref{fig:small_conrel}).
Dla niektórych instancji utrzymuje się na podobnym poziomie przez większość czasu,
ale gwałtownie zwiększa się pod koniec próbkowania.
W innych wartość miary znacznie zmienia się w trakcie procesu, formując ostre piki.
Gęstość grafu w każdym przypadku osiągała wysoką wartość, by następnie gwałtownie spaść i ustabilizować się w pewnym zakresie (rys. \ref{fig:small_density}).
W kilku przypadkach występował wzrost gęstości grafu pod koniec próbkowania.
Miara jest najbardziej stabilna dla instancji z miastami rozłożonymi równomiernie.
Miara distLO jest niestabilna, występują częste nagłe wzrosty i spadki jej wartości (rys. \ref{fig:small_distLO}).
W kilku przypadkach wystąpił duży spadek pod koniec próbkowania, w innych --- gwałtowny wzrost.
Współczynnik wzajemności (reciprocity) również jest niestabilny (rys. \ref{fig:small_reciprocity}).
W niektórych przypadkach występuje gwałtowny wzrost i spadek wartości na początku próbkowania.
Ciekawa jest instancja grid\_20 --- po spróbkowaniu odpowiednio dużej liczby wierzchołków
wzrost tej miary jest zbliżony do wzrostu liniowego.

Rozmiar największej kliki zmienia się ,,schodkowo'' w momencie, w którym albo ze spróbkowanych wierzchołków
powstanie większa klika lub nowy wierzchołek zostanie odnaleziony w już istniejącej (rys. \ref{fig:small_largest_clique_size}).
Wyniki sugerują że możliwe jest oszacowanie wielkości największej kliki przestrzeni na podstawie wartości
z krótszego próbkowania, zwłaszcza na podstawie danych z próbkowania dwufazowego, gdzie
wartość zmienia się mniej gwałtownie. Ze względu na stopniowy i nieliniowy charakter wzrostu zmiennej,
dokładność takiego szacowania nie będzie duża.
Liczba źródeł, ścieków i tzw. subsinks w grafie w wielu przypadkach początkowo rośnie, by nagle zmaleć na końcu próbkowania.
W przypadkach ze zbioru TSPLIB po pewnym czasie liczba ścieków i subsinks przestała się zmieniać.
Wszystkie trzy miary są niestabilne, mają charakter nieprzewidywalny (rys. \ref{fig:small_num_sinks}, rys. \ref{fig:small_num_sources}, rys. \ref{fig:small_num_subsinks}).

Charakterystyka wzrostu wartości średniego stopnia wchodzącego wierzchołka jest bardziej zbliżona do liniowej
w przypadku próbkowania dwufazowego. W instancjach cliques\_20, uniform\_20 i burma14 występuje
przyspieszenie wzrostu pod koniec próbkowania (rys. \ref{fig:small_avg_in_degree}).
W tych przypadkach z dużym prawdopodobieństwem algorytmy znalazły wszystkie optima lokalne.
Może być to powodem tego zjawiska.
W przypadku instancji grid\_20 o liczbie optimów lokalnych znacznie wyższej od pozostałych instancji tego rozmiaru,
wynik z próbkowania snowball ma charakter eksponencjalny.
Podobnie wyglądają miary największego stopnia wchodzącego, średniego stopnia wychodzącego i maksymalnego stopnia wychodzącego
(rys. \ref{fig:small_max_in_degree}, rys. \ref{fig:small_avg_out_degree}, rys \ref{fig:small_max_out_degree}).

Średnia waga pętli w grafie jest niestabilna, w niektórych przypadkach wzrost jest bliski liniowego, w innych
eksponencjalnego, a w pozostałych jest chaotyczny (rys. \ref{fig:small_avg_loop_weight}).
Średnia długość ścieżki w grafie zwiększa się gwałtownie na początku, po czym stabilizuje (rys. \ref{fig:small_avg_path_len}).
Pojawiają się przypadki odstające (w grid\_20 przy próbkowaniu snowball wartość dość szybko maleje),
ale dla większości przypadków wahania wartości po ustabilizowaniu są niewielkie.
Podobnie jest w przypadku średniej długości ścieżek do globalnego optimum.
Długość najdłuższej ścieżki do globalnego optimum zmniejsza i zwiększa się gwałtownie.
Jest nieprzewidywalna, podobnie jest z wartością maksymalną (rys. \ref{fig:small_avg_go_path_len}, rys. \ref{fig:small_max_go_path_len}).

Współczynnik go\_path\_ratio zmienia się zupełnie inaczej w zależności od algorytmu próbkowania (rys. \ref{fig:small_go_path_ratio}).
Próbkowanie dwufazowe rośnie gwałtownie i bardzo wcześnie się stabilizuje.
Próbkowanie snowball prowadzi natomiast do powolnego wzrostu z okazjonalnymi spadkami wartości.
Oba algorytmy osiągają podobną końcową wartość miary, ale próbkowanie dwufazowe osiąga ją przy mniejszej
liczbie spróbkowanych wierzchołków.

Liczba lejów w przestrzeni jest miarą niestabilną, wartość miary zmienia się w zupełnie inny sposób
dla różnych instancji (rys. \ref{fig:small_funnel_num}).
Rozmiar największego leja w przestrzeni rośnie liniowo dla danych uzyskanych z próbkowania
dwufazowego. Wartość uzyskana z próbkowania snowball nie jest tak stabilna (rys. \ref{fig:small_max_funnel_size}).
Wzrost średniego rozmiaru lejów dla próbkowania dwufazowego również jest bliski liniowego,
widać jednak na nim pewne odchylenia (rys. \ref{fig:small_mean_funnel_size}). W ramach wzrostu ilości optimów lokalnych w przestrzeni,
wykres uzyskany ze snowball coraz bardziej zbliża się do wzrostu eksponencjalnego.

Liczba spójnych podgrafów szybko stabilizuje się na stałej wartości dla większości przypadków (rys. \ref{fig:small_num_cc}).
Rozmiar największego spójnego podgrafu rośnie liniowo dla wszystkich instancji i algorytmów (rys. \ref{fig:small_largest_cc}).
Promień największego spójnego podgrafu zmienia się wielokrotnie o wartość 1 dla większości przypadków (rys. \ref{fig:small_largest_cc_radius}).

Im więcej wierzchołków znajduje się w zbiorze, tym więcej prób tworzenia krawędzi w algorytmie dwufazowym
się powiedzie. Dlatego można zaobserwować delikatne wypłaszczenie krzywej na wykresie liczby nieudanych prób.
Wyjątkiem jest tu instancja grid\_20  --- jest to spowodowane tym że algorytm nie znalazł wszystkich optimów
lokalnych przed końcem próbkowania (rys. \ref{fig:small_missed}).

\newpage

\subsection{Badanie stabilności dla dużych instancji} \label{section:experimentmain}
W tej sekcji opisano badania przeprowadzone dla instancji o rozmiarze 48 i większym. \\
Podobnie jak w eksperymentach opisanych w sekcji \ref{section:experimentsmall}, wykonano długotrwałe próbkowanie przestrzeni rozwiązań
i przedstawiono uzyskane wartości miar na wykresach.
Ponieważ instancje badane w tej sekcji cechują się znacznie większym rozmiarem przestrzeni rozwiązań, próbkowanie przeprowadzono
dla innego zestawu parametrów, wykonując zapisy w większych interwałach.

Próbkowanie algorytmem \textit{snowball} wykonano z następującymi parametrami:
\begin{itemize}
    \item $w_{len}$ --- długość losowego spaceru --- 10000
    \item $m$ --- liczba prób przeszukania sąsiedztwa --- 100
    \item $depth$ --- głębokość przeszukiwania --- 3
\end{itemize}

Próbkowanie prowadzono do momentu zakończenia losowego spaceru lub osiągnięcia liczby 100000 wierzchołków.
Dla instancji \textbf{cliques\_50} z powodu małej liczby optimów lokalnych zapis wykonywano co 100 znalezionych wierzchołków.
Dla pozostałych instancji stan próbkowania zapisywany był co 1000 znalezionych wierzchołków.

Próbkowanie algorytmem dwufazowym przeprowadzono z następującymi parametrami:
\begin{itemize}
    \item $n_{max}$ --- żądana liczba wierzchołków --- 1000
    \item $n_{att}$ --- liczba prób generowania wierzchołków --- 1000
    \item $e_{att}$ --- liczba prób generowania krawędzi --- 1000
    \item $n_{runs}$ --- liczba powtórzeń --- 100
\end{itemize}

Próbkowanie przeprowadzono przez ustaloną z góry liczbę powtórzeń, zapisując stan przestrzeni po zakończeniu każdego powtórzenia.
Po zakończeniu działania algorytmów, dla każdego zapisanego stanu przestrzeni obliczono wartości badanych miar. W ten sposób uzyskano
ich wartości w różnych etapach próbkowania przestrzeni.
Utworzono wykresy przedstawiające zależność wartości miar od liczby wierzchołków w grafie LON.
Przedstawiono je na rysunkach od \ref{fig:main_snowball_edge_count} do \ref{fig:main_twophase_missed}.

Ze względu na długi czas obliczeń i ograniczony czas realizacji projektu,
dla instancji \textbf{cliques\_50}, \textbf{cliques\_80}, \textbf{uniform\_50}, \textbf{att48}, \textbf{berlin52} i \textbf{pr76} i próbkowania dwufazowego
nie wykonano obliczeń wartości następujących miar:

\begin{itemize}
    \item num\_subsinks
    \item num\_cc
    \item largest\_cc
    \item largest\_cc\_radius
    \item avg\_path\_len
    \item largest\_clique\_size
    \item reciprocity
\end{itemize}

\subsubsection{Wyniki}
Obrazy zawierające wykresy nie są wymagane do zrozumienia wyników.
Zostały one zawarte w załączniku. Dla wygody czytelnika w opisie wyników umieszczono odnośniki do poszczególnych wykresów.

Wzrost liczby krawędzi w stosunku do liczby wierzchołków jest zbliżony do liniowego dla próbkowania \textit{snowball} (rys. \ref{fig:main_snowball_edge_count}).
Na wykresie wartości stosunku krawędzi do wierzchołków (rys. \ref{fig:main_snowball_edge_to_node}), w niektórych przypadkach widać co prawda gwałtowne zmiany, ale
ich bezwzględna wartość jest niewielka.
W przypadku próbkowania dwufazowego (rys. \ref{fig:main_twophase_edge_count}, rys.\ref{fig:main_twophase_edge_to_node}), ta zależność nie jest liniowa dla części instancji,
najlepiej widać to w przypadku instancji cliques\_50, cliques\_80, att48, berlin52, oraz pr76.
Dla instancji typu grid oraz pozostałych instancji ze zbioru tsplib zależność ma charakterystykę liniową lub zbliżoną do liniowej.

Współczynnik różnorodności grafu nie jest stabilny. Wykres jego wartości wygląda inaczej w niemal każdym przypadku
próbkowania \textit{snowball} (rys. \ref{fig:main_snowball_assortativity_deg}).
Dla próbkowania dwufazowego (rys. \ref{fig:main_twophase_assortativity_deg}) można zaobserwować eksponencjalny spadek wartości taj miary dla części instancji.
W innych przypadkach wzrasta ona szybko i oscyluje wokół pewnej wartości.
Odstającym przypadkiem są instancje grid\_80 i grid\_100. Wykres pokazuje dla nich stałą wartość 0.
W rzeczywistości otrzymano tutaj wartość nieprawidłową (NaN). Najprawdopodobniej mianownik wyrażenia \ref{eq:assortativity}
miał wartość 0.

Dla większości instancji o rozmiarze 50 średnia wartość funkcji celu jest niska na początku i wzrasta podczas dalszego próbkowania.
Zależność tą możemy zaobserwować zarówno w przypadku próbkowania snowball jak i dwufazowego (rys. \ref{fig:main_snowball_avg_fitness}, rys. \ref{fig:main_twophase_avg_fitness}).
W przypadku instancji większych oraz typu grid po początkowym spadku wartości, maleje ona dalej lub stabilizuje się na pewnym poziomie.
Nie jest to zaskakujące. W mniejszych instancjach problemu występuje mniej lokalnych optimów, więc zwiększa się szansa, że algorytm
natrafi na nie podczas krótszego próbkowania. Instancje większe zawierają znacznie więcej optimów lokalnych, więc nawet po długim próbkowaniu
algorytm wciąż natrafia na nowe o niższej wartości funkcji celu. Instancje typu grid charakteryzują się dużą liczbą optimów lokalnych,
więc problem ten występuje również dla mniejszych instancji tego typu.

Wartość współczynnika conrel jest niestabilna. Różni się ona w zależności od algorytmu próbkowania (rys. \ref{fig:main_snowball_conrel}, rys. \ref{fig:main_twophase_conrel}).
Dla większych instancji typu grid i próbkowania dwufazowego ma ona stałą wartość 0.
Wartość gęstości grafu (density) zmienia się w przewidywalny sposób dla próbkowania \textit{snowball} (rys. \ref{fig:main_snowball_density}) i maleje eksponencjalnie.
W przypadku próbkowania dwufazowego (rys. \ref{fig:main_twophase_density}) taki spadek występuje tylko w instancjach typu grid, instancji cliques\_100 oraz większych
instancjach ze zbioru tsplib.
Dla pozostałych instancji występują kolejne wzrosty i spadki wartości tej miary.
Z otrzymanych danych można wywnioskować, że wartość tej metryki jest w dużym stopniu zależna od wykorzystanego algorytmu próbkowania.
Wartość współczynnika distLO jest niestabilna. Zmienia się w nieprzewidywalny sposób zarówno dla algorytmu \textit{snowball} jak i dwufazowego (rys. \ref{fig:main_snowball_distLO}, rys. \ref{fig:main_twophase_distLO}).
Ciekawym przypadkiem są instancje grid dla próbkowania \textit{snowball} --- wartość distLO jest dla nich stała i wynosi 1. Oznacza to, że każda krawędź połączona
z najlepszym rozwiązaniem miała wagę 1 przez cały okres próbkowania.

Wzajemność grafu (reciprocity) w większości przypadkach gwałtownie zmienia się na początku, a potem stabilizuje w okolicach pewnej wartości.
W przypadku instancji grid\_80 i grid\_100 otrzymano wartości nieprawidłowe (NaN) dla całego okresu próbkowania dwufazowego (rys. \ref{fig:main_twophase_reciprocity}).
Jest to spowodowane tym, że wszystkie spróbkowane w tych instancjach krawędzie są pętlami.
Podobne nieprawidłowe wartości występują również na początku próbkowania dużych instancji rzeczywistych.
Jest to spowodowane działaniem algorytmu próbkowania. Na początku wiele optimów lokalnych nie znajduje się w zbiorze wierzchołków.
Z tego powodu nie udaje się utworzyć dużej ilości krawędzi prowadzących do nieodkrytych jeszcze wierzchołków.
Im większa przestrzeń przeszukiwania, tym dłużej będzie występował ten problem.
Zjawisko to nie występuje dla algorytmu \textit{snowball}, gdyż tam wierzchołki są próbkowane równocześnie z krawędziami i każda krawędź, która może powstać jest
tworzona od razu (rys. \ref{fig:main_snowball_reciprocity}) .

Rozmiar największej kliki w grafie wzrasta ,,schodkowo'' dla obu algorytmów (rys. \ref{fig:main_snowball_largest_clique_size}, (rys. \ref{fig:main_twophase_largest_clique_size})).
Dla największych instancji jego wartość nie zmienia się przez cały okres próbkowania.
Z danych można wywnioskować, że im mniejsza ilość lokalnych optimów w przestrzeni przeszukiwania, tym częściej zmienia się wartość tej miary.
Stała wartość dla dużych instancji nie oznacza, że można ją przyjąć za wartość miary dla całej przestrzeni --- najprawdopodobniej zmieni się
ona po jeszcze dłuższym próbkowaniu.

Liczba źródeł w grafie rośnie liniowo dla większości instancji przy próbkowaniu \textit{snowball} (rys. \ref{fig:main_snowball_num_sources}).
W przypadku próbkowania dwufazowego zależność liniowa występuje jedynie w przypadku największych instancji i instancji typu grid (rys. \ref{fig:main_twophase_num_sources}).
Ciekawym przypadkiem jest instancja cliques\_50, w której jako jedynej wartość tej miary zaczyna spadać pod koniec próbkowania.
Liczba ścieków w grafie również rośnie liniowo dla większości instancji w przypadku próbkowania \textit{snowball} (rys. \ref{fig:main_snowball_num_sinks}).
W przypadku próbkowania dwufazowego jest zupełnie inaczej. O ile liniowy wzrost wciąż występuje dla niektórych instancji, to w innych przypadkach
wartość ta maleje lub utrzymuje się na stałym poziomie. Instancja cliques\_50 również się tu wyróżnia --- w przestrzeni rozwiązań występują jedynie dwa ścieki
przez cały okres próbkowania (rys. \ref{fig:main_twophase_num_sinks}).
Wykresy ilości subsinks wyglądają niemal identycznie do wykresów ilości ścieków --- oznacza to, że ich liczba jest zawsze zbliżona
(rys. \ref{fig:main_snowball_num_subsinks}, rys. \ref{fig:main_twophase_num_subsinks}).

Średni stopień wchodzący wierzchołków jest miarą nieprzewidywalną dla próbkowania \textit{snowball} (rys. \ref{fig:main_snowball_avg_in_degree}).
W przypadku próbkowania dwufazowego wartość miary jest bardziej przewidywalna --- przez cały czas wzrasta dla większości przypadków (rys. \ref{fig:main_twophase_avg_in_degree}).
Wyjątkiem są instancje grid\_80 i grid\_100, w których przez cały okres próbkowania otrzymywana jest wartość 0.
Maksymalny stopień wchodzący dla części instancji wzrasta ,,schodkowo'', a dla innych łagodniej (rys. \ref{fig:main_snowball_max_in_degree}, rys. \ref{fig:main_twophase_max_in_degree}).
W przypadku algorytmu dwufazowego dla niektórych instancji wzrost jest bliski liniowego.
Instancje grid\_80 i grid\_100 mają maksymalny stopień wchodzący równy 0.
Oznacza to, że wszystkie krawędzie w tych grafach to pętle. Wyjaśnia to również wartość distLO równą 1 oraz nieprawidłową wartość reciprocity.
Podobnie prezentują się wykresy wartości średniej i maksymalnej stopnia wychodzącego
(rys. \ref{fig:main_snowball_avg_out_degree}, rys. \ref{fig:main_snowball_max_out_degree}, rys. \ref{fig:main_twophase_avg_out_degree}, rys. \ref{fig:main_twophase_max_out_degree}).

Średnia waga pętli w grafie jest nieprzewidywalna dla próbkowania \textit{snowball} (rys. \ref{fig:main_snowball_avg_loop_weight}, rys. \ref{fig:main_twophase_avg_loop_weight}).
Dla próbkowania dwufazowego wielkość ta wzrasta niemal liniowo dla każdej instancji oprócz cliques\_50.
Średnia długość ścieżki w grafie jest nieprzewidywalna dla większości instancji próbkowanych algorytmem \textit{snowball} (rys. \ref{fig:main_snowball_avg_path_len}).
Wyjątkiem są instancje typu grid, dla których wartość tej metryki stale wzrasta.
Dla próbkowania dwufazowego również nie uzyskano stabilnych wartości.
Pętle nie są brane pod uwagę w obliczaniu wartości tej metryki. Z tego powodu wynosi ona 0 dla większych instancji typu grid (rys. \ref{fig:main_twophase_avg_path_len}).
Średnia długość ścieżki do najlepszego rozwiązania jest nieprzewidywalna niezależnie od algorytmu próbkującego (rys. \ref{fig:main_snowball_avg_go_path_len}, rys. \ref{fig:main_twophase_avg_go_path_len}).
Nagłe zmiany w wartości są spowodowane najprawdopodobniej znalezieniem nowego najlepszego rozwiązania w przestrzeni.
Podobnie jest w przypadku wartości maksymalnej (rys. \ref{fig:main_snowball_max_go_path_len}, rys. \ref{fig:main_twophase_max_go_path_len}).
Współczynnik go\_path\_ratio jest nieprzewidywalny. O ile w niektórych przypadkach przy próbkowaniu dwufazowym stabilizuje się na pewnej wartości
po początkowym wzroście, to w innych gwałtownie zmniejsza się i zwiększa (rys. \ref{fig:main_snowball_go_path_ratio}, rys. \ref{fig:main_twophase_go_path_ratio}).

Dla próbkowania \textit{snowball} liczba lejów w przestrzeni wzrasta liniowo dla wszystkich instancji oprócz cliques\_50 (rys. \ref{fig:main_snowball_funnel_num}).
Inaczej jest w przypadku próbkowania dwufazowego --- tutaj zależność ta wygląda zupełnie inaczej dla różnych instancji.
Liniowy wzrost obserwujemy jedynie w instancjach: eil76, rat99, bier127, grid\_80, grid\_100. Podobnie wyglądają również uniform\_100 i grid\_50.
Dla instancji cliques\_50 wartość miary jest stała przez cały okres próbkowania. W przypadku instancji uniform\_50, att48 i berlin52 wartość miary
szybko zmniejsza się na początku, po czym utrzymuje stałą wartość do końca próbkowania (rys. \ref{fig:main_twophase_funnel_num}).
Rozmiar największego leja dla niektórych instancji wzrasta liniowo. Dla innych wzrasta ,,schodkowo'', a w przypadku instancji grid\_80 i grid\_100 dla
próbkowania dwufazowego --- ma stałą wartość 1. Oznacza to, że nie da się dokładnie przewidzieć wartości tej miary. Warto jednak zauważyć, że
,,schodkowe'' zwiększanie się wartości tej miary występuje w instancjach o największej liczbie lokalnych optimów.
Widoczne są wyraźne różnice pomiędzy wykresami uzyskanymi z próbkowania \textit{snowball} i dwufazowego (rys. \ref{fig:main_snowball_max_funnel_size}, rys. \ref{fig:main_twophase_max_funnel_size}).
Nieco inaczej przedstawiają się wykresy średniej wielkości lejów. O ile dla próbkowania snowball wartość zmienia się w sposób całkowicie nieprzewidywalny,
to wszystkie wykresy uzyskane z algorytmu dwufazowego (oprócz grid\_80 i grid\_100) wykazują tendencję wzrostową (choć w niektórych instancjach pojawiają się małe spadki wartości.)
(rys. \ref{fig:main_snowball_mean_funnel_size}, rys. \ref{fig:main_twophase_mean_funnel_size}).

Liczba spójnych podgrafów sieci LON jest stała dla wielu instancji w przypadku próbkowania \textit{snowball} (rys. \ref{fig:main_snowball_num_cc}). Dla innych zmienia się ona w nieprzewidywalny sposób.
W przypadku próbkowania dwufazowego i instancji grid liczba podgrafów jest równa liczbie wierzchołków, gdyż każdy wierzchołek w tych grafach jest wierzchołkiem izolowanym.
W przypadku instancji ze zbioru tsplib, liczba ta nie jest równa liczbie wierzchołków, ale jest bardzo bliska --- oznacza to, że znaczna większość
wierzchołków w tych grafach również jest izolowana (rys. \ref{fig:main_twophase_num_cc}).
W przypadku próbkowania \textit{snowball} rozmiar największego spójnego podgrafu wzrasta liniowo dla większości instancji. Dla instancji uniform\_100, oraz
eil76, rat99 i bier127 potrafi utrzymywać się na stałym poziomie przez dłuższy czas i nagle rosnąć (rys. \ref{fig:main_snowball_largest_cc}).
W przypadku próbkowania dwufazowego nie wzrasta on liniowo. Dla niektórych instancji wartość utrzymuje się na niskim poziomie przez długi czas (rys. \ref{fig:main_twophase_largest_cc}).
Dla instancji rat99 i bier127 zmienia się częściej niż w przypadku próbkowania \textit{snowball}.
Promień największego spójnego podgrafu sieci zmienia się w sposób nieprzewidywalny dla obu algorytmów (rys. \ref{fig:main_snowball_largest_cc_radius}, rys. \ref{fig:main_twophase_largest_cc_radius}).
Zależność liczby nieudanych prób tworzenia krawędzi przez algorytm dwufazowy wygląda bardzo podobnie dla wszystkich instancji (rys. \ref{fig:main_twophase_missed}).

Na wykresach \ref{fig:main_opt_nodes} i \ref{fig:main_opt_edges} możemy zobaczyć odpowiednio liczbę wierzchołków i liczbę krawędzi
w zależności od liczby wywołań funkcji optymalizującej. Liczba wywołań funkcji optymalizującej jest zarazem liczbą wywołań funkcji celu, gdyż
algorytm 2opt wykonuje pełną kalkulację długości ścieżki tylko raz.
Na wykresach kolorem niebieskim oznaczono algorytm \textit{snowball}, a pomarańczowym --- algorytm dwufazowy.
Oś X została przedstawiona w skali logarytmicznej.
Na wykresie wyraźnie widać, że spróbkowanie tej samej liczby wierzchołków zawiera o wiele więcej czasu algorytmowi dwufazowemu.
Należy jednak pamiętać, że w niektórych przypadkach (np. cliques\_50 ) szybszy algorytm \textit{snowball} nie odnalazł wszystkich optimów lokalnych w przestrzeni.
Dla wszystkich instancji cliques, uniform\_50 i uniform\_80, att48, berlin52 oraz pr76 algorytm dwufazowy znalazł również o wiele większą ilość krawędzi.
Co ważne, większość z nich została znaleziona w bardzo późnej fazie próbkowania.

\subsection{Korelacja wzajemna miar} \label{section:experimentcorr}
Aby sprawdzić, w jakim stopniu skorelowane są ze sobą poszczególne miary przestrzeni rozwiązań, obliczono współczynnik korelacji Pearsona dla każdej pary miar.
Współczynniki uzyskane ze wszystkich instancji badanych w sekcjach \ref{section:experimentsmall} i \ref{section:experimentmain} uśredniono i przestawiono na wykresach.
W przypadku, gdy wartość miary w danej instancji była stała, jako współczynnik korelacji przyjmowano wartość 0.
Wykonano osobne wykresy dla algorytmu dwufazowego i snowball, aby ocenić wpływ metody na korelację miar.
Wyniki dla algorytmu \textit{snowball} przedstawiono w tabeli \ref{fig:corr_snowball}.
Wyniki dla algorytmu dwufazowego przedstawiono w tabeli \ref{fig:corr_twophase}.
\begin{figure}[h!]
    \centering
    \includegraphics[width=\textwidth]{chapters/experiments/img/snowball_corr.png}
    \caption{Wzajemna korelacja miar --- próbkowanie snowball}
    \label{fig:corr_snowball}
\end{figure}

\begin{figure}[h!]
    \centering
    \includegraphics[width=\textwidth]{chapters/experiments/img/twophase_corr.png}
    \caption{Wzajemna korelacja miar --- próbkowanie dwufazowe}
    \label{fig:corr_twophase}
\end{figure}

Występuje wysoka dodatnia korelacja występuje pomiędzy liczbą wywołań funkcji celu (opt\_count),
liczbą obliczeń długości ścieżki metodą przyrostową (oracle\_count), liczbą wierzchołków (node\_count) i krawędzi (edge\_count).
Wspomniane wartości silnie korelują dodatnio z liczbą źródeł i ścieków, a także z metrykami lejowymi oraz średnimi i maksymalnymi wartościami stopni wierzchołków.
Korelacja ta występuje dla obu algorytmów, ale jest nieco silniejsza dla algorytmu dwufazowego.
Występuje bardzo silna korelacja między liczbą wywołań funkcji celu i średnią wagą pętli w algorytmie dwufazowym.
Nie jest to zaskakujące, gdyż --- szczególnie dla instancji z dużą liczbą optimów lokalnych --- algorytm ten ma tendencję do tworzenia pętli o bardzo dużych wagach.

Dla algorytmu \textit{snowball} występuje korelacja o wartościach bliskich 1 pomiędzy liczbą źródeł, ścieków i lejów w przestrzeni.
Dla algorytmu dwufazowego korelacja między liczbą źródeł i ścieków wynosi jedynie 0.25.
Metryki lejowe oraz dotyczące stopni wierzchołków są ze sobą silniej skorelowane w przypadku próbkowania dwufazowego.
Dla tego rodzaju próbkowania widoczna jest również dość silna ujemna korelacja między różnorodnością (assortativity\_deg) a tymi metrykami.
Różnorodność koreluje również ujemnie z metrykami conrel, go\_path\_ratio i avg\_loop\_weight.
W przypadku próbkowania \textit{snowball} występuje silna ujemna korelacja między gęstością grafu (density) a liczbą ścieków, liczbą źródeł i maksymalnym stopniem wychodzącym.
Metryka ta, dla obu rodzajów próbkowania, koreluje ujemnie z każdą inną metryką oprócz conrel.

Obliczono wartość średnią współczynników korelacji z innymi metrykami dla każdej metryki, aby sprawdzić, które z nich
są w najmniejszym stopniu zależne od innych. Wyniki przedstawiono w tabeli \ref{tab:meancorr}.
Najbliższymi 0 średnimi wartościami korelacji cechują się metryki: distLO, avg\_go\_path\_len, max\_go\_path\_len, largest\_cc\_radius.
Dla algorytmu snowball bliska zera jest również wartość dla współczynnika conrel, a dla algorytmu dwufazowego --- wartość dla miary density.

\begin{table}[]
    \centering
    \caption{Uśredniona wartość korelacji z innymi metrykami dla każdej metryki}
    \label{tab:meancorr}
    \begin{tabular}{|l|l|l|}
        \hline
        Metryka               & alg. snowball & alg. dwufazowy \\ \hline
        node\_count           & 0.53          & 0.52           \\ \hline
        edge\_count           & 0.52          & 0.53           \\ \hline
        num\_subsinks         & 0.45          & 0.39           \\ \hline
        edge\_to\_node        & 0.42          & 0.50           \\ \hline
        avg\_fitness          & 0.25          & 0.17           \\ \hline
        distLO                & 0.07          & -0.06          \\ \hline
        conrel                & -0.02         & 0.41           \\ \hline
        avg\_loop\_weight     & 0.40          & 0.50           \\ \hline
        go\_path\_ratio       & 0.32          & 0.31           \\ \hline
        avg\_go\_path\_len    & -0.03         & 0.02           \\ \hline
        max\_go\_path\_len    & 0.01          & 0.07           \\ \hline
        num\_sinks            & 0.45          & 0.29           \\ \hline
        num\_sources          & 0.49          & 0.41           \\ \hline
        funnel\_num           & 0.45          & 0.29           \\ \hline
        mean\_funnel\_size    & 0.29          & 0.49           \\ \hline
        max\_funnel\_size     & 0.49          & 0.48           \\ \hline
        max\_out\_degree      & 0.46          & 0.48           \\ \hline
        avg\_out\_degree      & 0.41          & 0.49           \\ \hline
        max\_in\_degree       & 0.50          & 0.48           \\ \hline
        avg\_in\_degree       & 0.41          & 0.49           \\ \hline
        assortativity\_deg    & 0.21          & -0.30          \\ \hline
        density               & -0.20         & -0.06          \\ \hline
        num\_cc               & 0.16          & 0.28           \\ \hline
        largest\_cc           & 0.53          & 0.48           \\ \hline
        largest\_cc\_radius   & 0.11          & 0.12           \\ \hline
        avg\_path\_len        & 0.08          & 0.22           \\ \hline
        largest\_clique\_size & 0.43          & 0.44           \\ \hline
        reciprocity           & 0.32          & 0.24           \\ \hline
        missed                & -             & 0.52           \\ \hline
    \end{tabular}
\end{table}


\subsection{Podsumowanie wyników}
W przypadku próbkowania małych instancji algorytm \textit{snowball} zwykle buduje sieć LON bliższą rzeczywistej.
Algorytm dwufazowy również radzi sobie z tym zadaniem, zwykle wymaga jednak znacznie dłuższych obliczeń.
Instancje typu grid --- z miastami ułożonymi na siatce --- sprawiają największe trudności i już dla jedenastu miast algorytmy nie znalazły
wszystkich wierzchołków i krawędzi.
Dla większości instancji o rozmiarze 8 i większym oba algorytmy poradziły sobie ze spróbkowaniem przestrzeni w czasie krótszym od przeglądu zupełnego.
Metryki oparte o bezwzględne wartości wag krawędzi (avg\_loop\_weight i distLO) nie dają informacji o wartościach w pełnej przestrzeni rozwiązań.

Nie występuje liniowa zależność między liczbą wierzchołków w przestrzeni, a liczbą krawędzi (rys. \ref{fig:included_snowball_edges}, rys. \ref{fig:included_twophase_edges}).
Większość miar przestrzeni rozwiązań zmienia się w sposób nieprzewidywalny (przykładem jest długość najdłuższej ścieżki do optimum globalnego rys. \ref{fig:included_max_go_path_len}).
Pojawiają się jednak i takie, których wartość stabilizuje się lub wzrasta w przewidywalny sposób.
Przykładem jest liczba źródeł i ścieków w przestrzeni uzyskanej w próbkowaniu \textit{snowball} (rys. \ref{fig:included_num_sources}).
Charakter wzrostu tych zmiennych umożliwia wykorzystanie ekstrapolacji liniowej do przewidzenia ich liczby
dla większej ilości spróbkowanych wierzchołków.
Istnieje jednak ryzyko, że przewidywana wartość będzie nieprawdziwa --- dla instancji o rozmiarze 20, oraz cliques\_50
zaobserwowano wypłaszczenie krzywej, a nawet szybki spadek wartości tej miary (rys. \ref{fig:included_num_sources_small}).
Podobny spadek zaobserwowano w niektórych przypadkach próbkowania dwufazowego.
Maksymalny stopień wierzchołków również można oszacować z pewną dokładnością, ale tylko dla instancji o rozmiarze mniejszym od 50.
Im więcej optimów lokalnych w przestrzeni, tym rzadziej zmienia się ta wartość i tym szersze ,,schodki'' widoczne są na wykresie (rys. \ref{fig:included_max_degree}).

Rodzaj zastosowanego algorytmu ma duży wpływ na to, jak wartości miary zmieniają się w miarę próbkowania.
Algorytm dwufazowy zaczyna tworzyć krawędzie dopiero po pewnym czasie, gdy w zbiorze wierzchołków znajduje się
odpowiednia ich ilość. Z tego powodu na wykresie liczby krawędzi dla algorytmu dwufazowego widzimy krzywą eksponencjalną.
Algorytm dwufazowy nie radzi sobie z największymi (pod względem liczby optimów lokalnych) instancjami
- zdecydowaną większość krawędzi (lub w przypadku większych instancji grid --- wszystkie krawędzie) stanowią w nich pętle,
które nie mogą być wykorzystane do obliczenia wartości większości metryk.
Dla tych instancji zbudowanie gęstszej sieci LON wymagałoby znacznego zwiększenia i tak już dużego wkładu obliczeniowego.
Warto jednak zwrócić uwagę na to, że w niektórych instancjach (np. cliques\_50) algorytm \textit{snowball} znalazł o wiele mniej
optimów lokalnych od algorytmu dwufazowego, pomimo długiego czasu próbkowania.
Oznacza to, że algorytm dwufazowy może odnaleźć optima lokalne, których znalezienie sprawia trudności algorytmowi \textit{snowball}.
Najprawdopodobniej jest to spowodowane bardziej losowym charakterem algorytmu dwufazowego.
Snowball kolejny etap przeszukiwania zaczyna od jednego z sąsiednich rozwiązań, algorytm dwufazowy
za każdym razem zaczyna od rozwiązania całkowicie losowego.

Zaobserwowano różnice między różnymi rodzajami instancji.
Instancja cliques\_50 z miastami ułożonymi w klikach ma o wiele mniej optimów lokalnych od instancji innego typu o podobnym rozmiarze.
Instancje typu grid z miastami ułożonymi na siatce mają ich z kolei znacznie więcej.
Instancje tego typu są również najtrudniejsze do próbkowania algorytmem dwufazowym.
Instancje typu uniform często wykazują inne właściwości od innych instancji tego samego typu.
Nie jest to zaskakujące --- są to instancje losowe bez ustalonej struktury i wiele zależy od ułożenia miast w konkretnej instancji.

Instancje cliques\_50, cliques\_80, uniform\_50, att48, berlin52 i pr76 cechują się wyjątkowo dużą liczbą krawędzi
w stosunku do liczby wierzchołków (stosunek ten był największy dla instancji att48 i wynosił ponad 1300 do 1).
Krawędzie te nie zostały odnalezione przez algorytm \textit{snowball}, a jedynie w późnym etapie próbkowania dwufazowego (\ref{fig:included_edgeopt}).
Istnienie milionów krawędzi znacznie wydłużyło długość obliczeń, oraz rozmiar plików z reprezentacją grafu i była powodem rezygnacji z obliczenia
wartości części miar w tym badaniu.

Wiele miar jest ze sobą silnie skorelowanych, większość dodatnio.
Istnieje jednak kilka miar, których wartość jest praktycznie niezależna od innych.
Wybór algorytmu próbkowania ma znaczący wpływ na wzajemną korelację pomiędzy wartościami niektórych miar.

\begin{figure}[]
    \centering
    \includegraphics[width=\textwidth]{chapters/experiments/img/merged_plots/main_snowball/edge_count.png}
    \caption{Stosunek liczby krawędzi do liczby wierzchołków (edge\_to\_node) --- próbkowanie snowball}
    \label{fig:included_snowball_edges}
\end{figure}

\begin{figure}[]
    \centering
    \includegraphics[width=\textwidth]{chapters/experiments/img/merged_plots/main_twophase/edge_count.png}
    \caption{Stosunek liczby krawędzi do liczby wierzchołków (edge\_to\_node) --- próbkowanie dwufazowe}
    \label{fig:included_twophase_edges}
\end{figure}

\begin{figure}[]
    \centering
    \includegraphics[width=\textwidth]{chapters/experiments/img/merged_plots/main_twophase/max_go_path_len.png}
    \caption{Wykres miary max\_go\_path\_len dla próbkowania dwufazowego --- przykład miary nieprzewidywalnej}
    \label{fig:included_max_go_path_len}
\end{figure}

\begin{figure}[]
    \centering
    \includegraphics[width=\textwidth]{chapters/experiments/img/merged_plots/main_snowball/num_sources.png}
    \caption{Wykres miary num\_sources dla próbkowania snowball --- przykład miary o wartościach zmieniających się w przewidywalny sposób}
    \label{fig:included_num_sources}
\end{figure}

\begin{figure}[]
    \centering
    \includegraphics[width=\textwidth]{chapters/experiments/img/merged_plots/per1_all/num_sources.png}
    \caption{Wykres miary num\_sources dla instancji średniej wielkości}
    \label{fig:included_num_sources_small}
\end{figure}

\begin{figure}[]
    \centering
    \includegraphics[width=\textwidth]{chapters/experiments/img/merged_plots/main_twophase/max_out_degree.png}
    \caption{Wykres miary max\_out\_degree dla próbkowania dwufazowego}
    \label{fig:included_max_degree}
\end{figure}

\begin{figure}[]
    \centering
    \includegraphics[width=\textwidth]{chapters/experiments/img/opt_edges.png}
    \caption{Wykres zależności liczby krawędzi od liczby wywołań funkcji celu.
        Kolor niebieski - próbkowanie snowball, kolor pomarańczowy --- próbkowanie dwufazowe.
        Oś X w skali logarytmicznej}
    \label{fig:included_edgeopt}
\end{figure}
